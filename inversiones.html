<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>FinanceHub — Inversiones</title>
<link rel="stylesheet" href="css/style.css">
<style>
:root{
  --brand:#2563eb; --accent:#3b82f6; --ok:#16a34a; --warn:#f59e0b; --bad:#ef4444;
}
.brand-new { 
  background: linear-gradient(135deg, var(--brand), var(--accent));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  font-weight: 900;
}
.inversion-card {
  border: 1px solid var(--line);
  border-radius: 12px;
  padding: 16px;
  margin: 12px 0;
  background: #fff;
}
.inversion-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 12px;
}
.rendimiento {
  font-size: 18px;
  font-weight: 700;
}
.rendimiento.positive { color: var(--ok); }
.rendimiento.negative { color: var(--bad); }
</style>
</head>
<body>
  <div class="topbar">
    <div class="top-inner">
      <div class="brand">
        <div class="logo" style="background: var(--brand);">💰</div>
        <div class="title brand-new">FinanceHub — Inversiones</div>
      </div>
      <nav class="nav">
        <a href="finanzas.html">Dashboard</a>
        <a href="cuentas.html">Cuentas</a>
        <a href="presupuestos.html">Presupuestos</a>
        <a href="inversiones.html" class="active">Inversiones</a>
        <a href="propiedades.html">Propiedades</a>
        <a href="configuracion.html">Configuración</a>
      </nav>
    </div>
  </div>

  <main class="container">
    <div class="card">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
        <div>
          <h2>Cartera de Inversiones</h2>
          <p class="muted">Controla y analiza el rendimiento de tus inversiones</p>
        </div>
        <button class="btn primary" onclick="showAddInversionModal()">+ Nueva Inversión</button>
      </div>

      <div class="stats-row" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin: 20px 0;">
        <div class="stat-card" style="background: #fff; border: 1px solid var(--line); border-radius: 12px; padding: 16px; text-align: center;">
          <div style="color: var(--ink2); font-size: 12px; text-transform: uppercase; letter-spacing: 0.5px;">Valor Total</div>
          <div id="valor-total" style="font-size: 28px; font-weight: 800; color: var(--brand); margin: 8px 0;">€0</div>
        </div>
        <div class="stat-card" style="background: #fff; border: 1px solid var(--line); border-radius: 12px; padding: 16px; text-align: center;">
          <div style="color: var(--ink2); font-size: 12px; text-transform: uppercase; letter-spacing: 0.5px;">Inversión Total</div>
          <div id="inversion-total" style="font-size: 28px; font-weight: 800; color: var(--brand); margin: 8px 0;">€0</div>
        </div>
        <div class="stat-card" style="background: #fff; border: 1px solid var(--line); border-radius: 12px; padding: 16px; text-align: center;">
          <div style="color: var(--ink2); font-size: 12px; text-transform: uppercase; letter-spacing: 0.5px;">Rendimiento</div>
          <div id="rendimiento-total" style="font-size: 28px; font-weight: 800; color: var(--ok); margin: 8px 0;">+0%</div>
        </div>
        <div class="stat-card" style="background: #fff; border: 1px solid var(--line); border-radius: 12px; padding: 16px; text-align: center;">
          <div style="color: var(--ink2); font-size: 12px; text-transform: uppercase; letter-spacing: 0.5px;">Ganancia/Pérdida</div>
          <div id="ganancia-perdida" style="font-size: 28px; font-weight: 800; color: var(--ok); margin: 8px 0;">€0</div>
        </div>
      </div>

      <div id="inversiones-list">
        <!-- Las inversiones se cargarán dinámicamente -->
      </div>
    </div>
  </main>

  <!-- Modal para agregar/editar inversión -->
  <div id="modal-overlay" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center;">
    <div style="background: #fff; border-radius: 16px; padding: 24px; max-width: 500px; width: 90%; max-height: 80vh; overflow-y: auto;">
      <h3 id="modal-title">Nueva Inversión</h3>
      
      <form id="inversion-form">
        <div class="row">
          <div class="field">
            <label>Nombre de la inversión</label>
            <input type="text" id="inversion-nombre" placeholder="Ej: Acciones Apple, Bitcoin, Fondo Indexado..." required>
          </div>
        </div>

        <div class="row two" style="grid-template-columns: 1fr 1fr;">
          <div class="field">
            <label>Tipo de inversión</label>
            <select id="inversion-tipo" required>
              <option value="">Seleccionar tipo</option>
              <option value="acciones">Acciones</option>
              <option value="fondos">Fondos de Inversión</option>
              <option value="etf">ETF</option>
              <option value="criptomonedas">Criptomonedas</option>
              <option value="bonos">Bonos</option>
              <option value="commodities">Materias Primas</option>
              <option value="reit">REIT</option>
              <option value="otro">Otro</option>
            </select>
          </div>
          <div class="field">
            <label>Símbolo/Ticker (opcional)</label>
            <input type="text" id="inversion-ticker" placeholder="AAPL, BTC, SPY...">
          </div>
        </div>

        <div class="row two" style="grid-template-columns: 1fr 1fr;">
          <div class="field">
            <label>Cantidad/Unidades</label>
            <input type="number" step="0.00001" id="inversion-cantidad" placeholder="0" required>
          </div>
          <div class="field">
            <label>Precio de compra (€)</label>
            <input type="number" step="0.01" id="inversion-precio-compra" placeholder="0.00" required>
          </div>
        </div>

        <div class="row two" style="grid-template-columns: 1fr 1fr;">
          <div class="field">
            <label>Precio actual (€)</label>
            <input type="number" step="0.01" id="inversion-precio-actual" placeholder="0.00">
          </div>
          <div class="field">
            <label>Fecha de compra</label>
            <input type="date" id="inversion-fecha" required>
          </div>
        </div>

        <div class="row">
          <div class="field">
            <label>Notas (opcional)</label>
            <textarea id="inversion-notas" rows="3" placeholder="Información adicional sobre la inversión..."></textarea>
          </div>
        </div>

        <div class="actions" style="margin-top: 20px; display: flex; gap: 10px; justify-content: flex-end;">
          <button type="button" class="btn ghost" onclick="closeModal()">Cancelar</button>
          <button type="submit" class="btn primary">Guardar</button>
        </div>
      </form>
    </div>
  </div>

  <script src="js/app.js"></script>
  <script>
    let editingInversionId = null;

    function loadInversiones() {
      const inversiones = Store.inversiones || [];
      const container = document.getElementById('inversiones-list');
      
      if (inversiones.length === 0) {
        container.innerHTML = '<p class="muted" style="text-align: center; padding: 40px;">No tienes inversiones registradas. ¡Añade tu primera inversión!</p>';
        updateStats(inversiones);
        return;
      }

      container.innerHTML = inversiones.map(inversion => createInversionCard(inversion)).join('');
      updateStats(inversiones);
    }

    function createInversionCard(inversion) {
      const valorInicial = (inversion.cantidad || 0) * (inversion.precioCompra || 0);
      const valorActual = (inversion.cantidad || 0) * (inversion.precioActual || inversion.precioCompra || 0);
      const gananciaPerdida = valorActual - valorInicial;
      const porcentajeRendimiento = valorInicial > 0 ? ((gananciaPerdida / valorInicial) * 100) : 0;

      const fechaCompra = inversion.fechaCompra ? new Date(inversion.fechaCompra).toLocaleDateString() : 'Sin fecha';

      return `
        <div class="inversion-card">
          <div class="inversion-header">
            <div>
              <h4 style="margin: 0;">${inversion.nombre}</h4>
              <p style="margin: 4px 0; color: var(--ink2); font-size: 12px;">
                ${inversion.tipo.charAt(0).toUpperCase() + inversion.tipo.slice(1)}
                ${inversion.ticker ? ` (${inversion.ticker})` : ''}
                · ${fechaCompra}
              </p>
            </div>
            <div style="text-align: right;">
              <div class="rendimiento ${gananciaPerdida >= 0 ? 'positive' : 'negative'}">
                ${gananciaPerdida >= 0 ? '+' : ''}${porcentajeRendimiento.toFixed(2)}%
              </div>
              <div style="font-size: 12px; color: var(--ink2);">
                ${e0(valorActual)} (${gananciaPerdida >= 0 ? '+' : ''}${e0(gananciaPerdida)})
              </div>
            </div>
          </div>
          
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 12px; margin-top: 12px;">
            <div>
              <div style="font-size: 11px; color: var(--ink2); text-transform: uppercase;">Cantidad</div>
              <div style="font-weight: 600;">${Number(inversion.cantidad || 0).toLocaleString()}</div>
            </div>
            <div>
              <div style="font-size: 11px; color: var(--ink2); text-transform: uppercase;">Precio Compra</div>
              <div style="font-weight: 600;">${e0(inversion.precioCompra || 0)}</div>
            </div>
            <div>
              <div style="font-size: 11px; color: var(--ink2); text-transform: uppercase;">Precio Actual</div>
              <div style="font-weight: 600;">${e0(inversion.precioActual || inversion.precioCompra || 0)}</div>
            </div>
            <div>
              <div style="font-size: 11px; color: var(--ink2); text-transform: uppercase;">Inversión Total</div>
              <div style="font-weight: 600;">${e0(valorInicial)}</div>
            </div>
          </div>

          <div style="display: flex; justify-content: flex-end; margin-top: 12px; gap: 8px;">
            <button class="btn-icon" onclick="editInversion('${inversion.id}')" title="Editar" style="width: 28px; height: 28px; border: 1px solid var(--line); border-radius: 6px; background: #fff; cursor: pointer; display: flex; align-items: center; justify-content: center;">✏️</button>
            <button class="btn-icon" onclick="deleteInversion('${inversion.id}')" title="Eliminar" style="width: 28px; height: 28px; border: 1px solid var(--line); border-radius: 6px; background: #fff; cursor: pointer; display: flex; align-items: center; justify-content: center;">🗑️</button>
          </div>
        </div>
      `;
    }

    function updateStats(inversiones) {
      let valorTotal = 0;
      let inversionTotal = 0;
      let gananciaPerdidaTotal = 0;

      inversiones.forEach(inversion => {
        const valorInicial = (inversion.cantidad || 0) * (inversion.precioCompra || 0);
        const valorActual = (inversion.cantidad || 0) * (inversion.precioActual || inversion.precioCompra || 0);
        
        valorTotal += valorActual;
        inversionTotal += valorInicial;
        gananciaPerdidaTotal += (valorActual - valorInicial);
      });

      const rendimientoTotal = inversionTotal > 0 ? ((gananciaPerdidaTotal / inversionTotal) * 100) : 0;

      document.getElementById('valor-total').textContent = e0(valorTotal);
      document.getElementById('inversion-total').textContent = e0(inversionTotal);
      document.getElementById('rendimiento-total').textContent = 
        (gananciaPerdidaTotal >= 0 ? '+' : '') + rendimientoTotal.toFixed(2) + '%';
      document.getElementById('ganancia-perdida').textContent = 
        (gananciaPerdidaTotal >= 0 ? '+' : '') + e0(gananciaPerdidaTotal);

      // Actualizar colores según rendimiento
      const rendimientoEl = document.getElementById('rendimiento-total');
      const gananciaEl = document.getElementById('ganancia-perdida');
      
      if (gananciaPerdidaTotal >= 0) {
        rendimientoEl.style.color = 'var(--ok)';
        gananciaEl.style.color = 'var(--ok)';
      } else {
        rendimientoEl.style.color = 'var(--bad)';
        gananciaEl.style.color = 'var(--bad)';
      }
    }

    function showAddInversionModal() {
      editingInversionId = null;
      document.getElementById('modal-title').textContent = 'Nueva Inversión';
      document.getElementById('inversion-form').reset();
      document.getElementById('inversion-fecha').value = new Date().toISOString().split('T')[0];
      document.getElementById('modal-overlay').style.display = 'flex';
    }

    function editInversion(id) {
      const inversiones = Store.inversiones || [];
      const inversion = inversiones.find(i => i.id === id);
      if (!inversion) return;

      editingInversionId = id;
      document.getElementById('modal-title').textContent = 'Editar Inversión';
      document.getElementById('inversion-nombre').value = inversion.nombre;
      document.getElementById('inversion-tipo').value = inversion.tipo;
      document.getElementById('inversion-ticker').value = inversion.ticker || '';
      document.getElementById('inversion-cantidad').value = inversion.cantidad || 0;
      document.getElementById('inversion-precio-compra').value = inversion.precioCompra || 0;
      document.getElementById('inversion-precio-actual').value = inversion.precioActual || '';
      document.getElementById('inversion-fecha').value = inversion.fechaCompra || '';
      document.getElementById('inversion-notas').value = inversion.notas || '';
      document.getElementById('modal-overlay').style.display = 'flex';
    }

    function deleteInversion(id) {
      if (confirm('¿Estás seguro de que quieres eliminar esta inversión?')) {
        const inversiones = Store.inversiones || [];
        Store.inversiones = inversiones.filter(i => i.id !== id);
        loadInversiones();
      }
    }

    function closeModal() {
      document.getElementById('modal-overlay').style.display = 'none';
      editingInversionId = null;
    }

    // Manejar envío del formulario
    document.getElementById('inversion-form').addEventListener('submit', function(e) {
      e.preventDefault();
      
      const inversionData = {
        id: editingInversionId || 'inversion_' + Date.now(),
        nombre: document.getElementById('inversion-nombre').value.trim(),
        tipo: document.getElementById('inversion-tipo').value,
        ticker: document.getElementById('inversion-ticker').value.trim(),
        cantidad: parseFloat(document.getElementById('inversion-cantidad').value) || 0,
        precioCompra: parseFloat(document.getElementById('inversion-precio-compra').value) || 0,
        precioActual: parseFloat(document.getElementById('inversion-precio-actual').value) || null,
        fechaCompra: document.getElementById('inversion-fecha').value,
        notas: document.getElementById('inversion-notas').value.trim(),
        fechaCreacion: editingInversionId ? undefined : new Date().toISOString(),
        fechaModificacion: new Date().toISOString()
      };

      // Si no se especifica precio actual, usar precio de compra
      if (!inversionData.precioActual) {
        inversionData.precioActual = inversionData.precioCompra;
      }

      const inversiones = Store.inversiones || [];
      
      if (editingInversionId) {
        const index = inversiones.findIndex(i => i.id === editingInversionId);
        if (index !== -1) {
          inversiones[index] = { ...inversiones[index], ...inversionData };
        }
      } else {
        inversiones.push(inversionData);
      }

      Store.inversiones = inversiones;
      loadInversiones();
      closeModal();
    });

    // Cerrar modal al hacer clic fuera
    document.getElementById('modal-overlay').addEventListener('click', function(e) {
      if (e.target === this) {
        closeModal();
      }
    });

    // Inicializar
    document.addEventListener('DOMContentLoaded', () => {
      loadInversiones();
    });
  </script>
</body>
</html>