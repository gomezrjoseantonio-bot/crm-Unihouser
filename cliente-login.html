<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Smaartflip - Acceso Cliente</title>
<style>
:root{
  --brand:#c7530c; --accent:#DB824B; --ok:#58736F; --bad:#B53928;
  --line:#E7E1DE; --chip:#F3EEE9; --bg:#FAF8F7; --ink:#1a1f23; --ink2:#535b63;
  --shadow:0 4px 22px rgba(0,0,0,.06);
  --ui-font: system-ui, -apple-system, Inter, Roboto, Arial, sans-serif;
  --ui-font-size: 14px;
}
*{box-sizing:border-box}
html,body{height:100%;margin:0;background:var(--bg);color:var(--ink);font-family:var(--ui-font);font-size:var(--ui-font-size)}

.login-container{
  min-height:100vh;
  display:flex;
  align-items:center;
  justify-content:center;
  padding:20px;
}

.login-card{
  background:#fff;
  border-radius:16px;
  padding:40px;
  box-shadow:var(--shadow);
  width:100%;
  max-width:400px;
  text-align:center;
}

.logo{
  width:60px;
  height:60px;
  border-radius:16px;
  background:var(--brand);
  color:#fff;
  display:flex;
  align-items:center;
  justify-content:center;
  font-weight:800;
  font-size:24px;
  margin:0 auto 20px;
}

h1{
  margin:0 0 8px;
  font-size:24px;
  font-weight:800;
  color:var(--ink);
}

.subtitle{
  color:var(--ink2);
  margin:0 0 32px;
  font-size:15px;
}

.field{
  margin-bottom:20px;
  text-align:left;
}

.field label{
  display:block;
  margin-bottom:8px;
  font-weight:600;
  color:var(--ink);
}

.field input{
  width:100%;
  padding:14px 16px;
  border:1px solid var(--line);
  border-radius:12px;
  background:#fff;
  color:var(--ink);
  font-size:15px;
  transition:border-color 0.2s;
}

.field input:focus{
  outline:none;
  border-color:var(--brand);
  box-shadow:0 0 0 3px rgba(199,83,12,0.1);
}

.btn{
  width:100%;
  padding:14px;
  background:var(--brand);
  color:#fff;
  border:none;
  border-radius:12px;
  font-size:16px;
  font-weight:700;
  cursor:pointer;
  transition:background-color 0.2s;
}

.btn:hover{
  background:#a0460a;
}

.btn:disabled{
  background:#ccc;
  cursor:not-allowed;
}

.error{
  background:#fff5f5;
  border:1px solid #fed7d7;
  color:#c53030;
  padding:12px;
  border-radius:8px;
  margin:16px 0;
  text-align:center;
  display:none;
}

.footer{
  margin-top:32px;
  color:var(--ink2);
  font-size:13px;
}

.loading{
  display:none;
  text-align:center;
  color:var(--ink2);
  margin:16px 0;
}
</style>
</head>
<body>

<div class="login-container">
  <div class="login-card">
    <div class="logo">S</div>
    <h1>Smaartflip</h1>
    <p class="subtitle">Acceso al área de clientes</p>
    
    <form id="loginForm">
      <div class="field">
        <label for="dni">DNI</label>
        <input type="text" id="dni" placeholder="12345678A" required>
      </div>
      
      <div class="field">
        <label for="email">Correo electrónico</label>
        <input type="email" id="email" placeholder="correo@ejemplo.com" required>
      </div>
      
      <div class="field">
        <label for="movil">Teléfono móvil</label>
        <input type="tel" id="movil" placeholder="600123456" required>
      </div>
      
      <div class="error" id="errorMsg"></div>
      <div class="loading" id="loading">Verificando datos...</div>
      
      <button type="submit" class="btn" id="loginBtn">Acceder</button>
    </form>
    
    <div class="footer">
      Si tienes problemas para acceder, contacta con nosotros
    </div>
  </div>
</div>

<script>
"use strict";

// Store para acceder a los datos del CRM
const Store = {
  get pros() {
    try {
      return JSON.parse(localStorage.getItem('pros') || '[]');
    } catch(_) {
      return [];
    }
  }
};

function showError(message) {
  const errorEl = document.getElementById('errorMsg');
  errorEl.textContent = message;
  errorEl.style.display = 'block';
}

function hideError() {
  document.getElementById('errorMsg').style.display = 'none';
}

function showLoading() {
  document.getElementById('loading').style.display = 'block';
  document.getElementById('loginBtn').disabled = true;
}

function hideLoading() {
  document.getElementById('loading').style.display = 'none';
  document.getElementById('loginBtn').disabled = false;
}

function normalizeString(str) {
  return (str || '').toString().toLowerCase().trim();
}

function authenticateClient(dni, email, movil) {
  const clients = Store.pros;
  
  return clients.find(client => {
    const clientDni = normalizeString(client.dni);
    const clientEmail = normalizeString(client.email);
    const clientMovil = normalizeString(client.movil || client.phone || client.telefono);
    
    return clientDni === normalizeString(dni) &&
           clientEmail === normalizeString(email) &&
           clientMovil === normalizeString(movil);
  });
}

document.getElementById('loginForm').addEventListener('submit', function(e) {
  e.preventDefault();
  hideError();
  
  const dni = document.getElementById('dni').value.trim();
  const email = document.getElementById('email').value.trim();
  const movil = document.getElementById('movil').value.trim();
  
  if (!dni || !email || !movil) {
    showError('Por favor, completa todos los campos');
    return;
  }
  
  showLoading();
  
  // Simular delay de verificación
  setTimeout(() => {
    const client = authenticateClient(dni, email, movil);
    
    if (client) {
      // Guardar sesión del cliente
      sessionStorage.setItem('clientSession', JSON.stringify({
        clientId: client.id,
        loginTime: Date.now()
      }));
      
      // Redirigir al dashboard del cliente
      window.location.href = 'cliente-dashboard.html';
    } else {
      hideLoading();
      showError('Los datos no coinciden con ningún cliente registrado. Verifica tu información.');
    }
  }, 1000);
});

// Limpiar error al escribir
['dni', 'email', 'movil'].forEach(fieldId => {
  document.getElementById(fieldId).addEventListener('input', hideError);
});
</script>

</body>
</html>