<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Unihouser — Evaluaciones</title>
<link rel="stylesheet" href="css/style.css">
<style>
/* mínimos locales para drawer/toasts (respetando tu estilo base) */
.uh-overlay{position:fixed;inset:0;background:rgba(15,18,20,.28);backdrop-filter:blur(2px);display:none;z-index:80}
.uh-overlay.open{display:block}
.uh-drawer{position:fixed;top:0;right:-520px;height:100%;width:520px;max-width:100%;background:#fff;border-left:1px solid #e5e7eb;box-shadow:0 10px 24px rgba(0,0,0,.2);transition:right .2s ease;z-index:90}
.uh-drawer.open{right:0}
.uh-d-head{display:flex;align-items:center;justify-content:space-between;padding:16px;border-bottom:1px solid #eef2f7}
.uh-d-body{padding:16px 16px 24px;overflow:auto;height:calc(100% - 60px)}
.uh-meta{font-size:12px;color:#667085;margin-bottom:8px}
.uh-kv{display:flex;justify-content:space-between;border-bottom:1px dashed #eef2f7;padding:6px 0}
.uh-kv .k{color:#667085}.uh-kv .v{font-weight:700}
.uh-list-pros label{display:flex;gap:8px;align-items:center;padding:6px 0;border-bottom:1px solid #f3f4f6}
.toast-wrap{position:fixed;bottom:18px;right:18px;display:flex;flex-direction:column;gap:8px;z-index:100}
.toast{background:#0f1112;color:#fff;padding:10px 12px;border-radius:10px;opacity:.98}
.toast.ok{background:#16a34a}.toast.warn{background:#f59e0b}.toast.bad{background:#ef4444}
.pill{display:inline-block;padding:.2rem .5rem;border-radius:999px;background:#f1f5f9;font-size:12px}
.filters .row{display:grid;gap:10px;grid-template-columns:2fr 1fr 1fr 1fr auto auto auto}
@media(max-width:1100px){.filters .row{grid-template-columns:1fr 1fr}}
table.table{width:100%;border-collapse:separate;border-spacing:0;background:#fff;border:1px solid #e5e7eb;border-radius:12px;overflow:hidden}
.table th,.table td{padding:10px 12px;border-bottom:1px solid #eef2f7;text-align:left;font-size:14px;white-space:nowrap}
.table th{background:#f8fafc;color:#111827;cursor:pointer}
.table tr:last-child td{border-bottom:none}
.table tr{cursor:pointer}
.btn.sm{padding:8px 10px;font-size:13px;border-radius:10px}
.empty{padding:14px;border:1px dashed #e2e8f0;border-radius:12px;color:#667085;margin-top:10px}
</style>
</head>
<body>
<header class="topbar">
  <div class="container flex between center">
    <div class="brand flex center"><div class="title">Unihouser — CRM & BuyBox</div></div>
    <nav class="nav">
      <a href="evaluar.html">Evaluar</a>
      <a href="evaluaciones.html" class="active">Evaluaciones</a>
      <a href="prospectos.html">Prospectos</a>
      <a href="dashboard.html">Dashboard</a>
      <a href="configuracion.html">Configuración</a>
    </nav>
  </div>
</header>

<main class="container">
<section class="card">
  <h2>Evaluaciones</h2>

  <div class="kpis" style="margin-top:6px;display:grid;gap:10px;grid-template-columns:repeat(4,1fr)">
    <div class="kpi"><div class="lab">Total evaluaciones</div><div class="val" id="k_total">0</div></div>
    <div class="kpi"><div class="lab">Asignadas</div><div class="val" id="k_asig">0</div></div>
    <div class="kpi"><div class="lab">Bruta media</div><div class="val" id="k_bruta">0,0 %</div></div>
    <div class="kpi"><div class="lab">Neta media</div><div class="val" id="k_neta">0,0 %</div></div>
  </div>

  <div class="card" style="margin-top:12px">
    <h3 style="margin:0 0 6px">Filtros</h3>
    <div class="filters">
      <div class="row">
        <div class="field"><label>Buscar</label><input id="f_text" placeholder="Localidad o calle"></div>
        <div class="field"><label>Tipo</label>
          <select id="f_tipo"><option value="">Todos</option><option>Tradicional</option><option>Habitaciones</option></select>
        </div>
        <div class="field"><label>Desde</label><input id="f_desde" type="date"></div>
        <div class="field"><label>Hasta</label><input id="f_hasta" type="date"></div>
        <div class="field" style="align-self:end"><button class="btn" id="b_limpiar">Limpiar</button></div>
        <div class="field" style="align-self:end"><button class="btn primary" id="b_filtrar">Filtrar</button></div>
        <div class="field" style="align-self:end"><button class="btn" id="b_export">Exportar CSV</button></div>
      </div>
    </div>
  </div>

  <div class="card" style="margin-top:12px">
    <div id="empty" class="empty" style="display:none">No hay evaluaciones guardadas aún. Ve a <strong>Evaluar</strong>, calcula y pulsa “Guardar”.</div>
    <table class="table" id="tbl" style="display:none">
      <thead>
        <tr>
          <th data-k="ts">Fecha</th>
          <th data-k="loc">Localidad</th>
          <th data-k="calle">Calle</th>
          <th data-k="tipo">Tipo</th>
          <th data-k="precio" style="text-align:right">Precio</th>
          <th data-k="alq" style="text-align:right">Alquiler</th>
          <th data-k="kpi_bruta" style="text-align:right">Bruta %</th>
          <th data-k="kpi_neta" style="text-align:right">Neta %</th>
          <th data-k="kpi_flujo" style="text-align:right">Flujo</th>
          <th data-k="pmax" style="text-align:right">P. máx</th>
          <th data-k="asig" style="text-align:center">Asignados</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody id="tbody"></tbody>
    </table>
  </div>
</section>
</main>

<footer class="foot"><div class="container foot-inner">© 2025 Unihouser · unihouser.es · info@unihouser.es · 644 300 200</div></footer>

<div id="uhOverlay" class="uh-overlay"></div>
<aside id="uhDrawer" class="uh-drawer" aria-hidden="true">
  <div class="uh-d-head">
    <strong>Detalle de evaluación</strong>
    <button class="btn" id="d_cerrar">Cerrar</button>
  </div>
  <div class="uh-d-body">
    <div class="uh-meta" id="d_fecha">—</div>

    <div class="uh-kv"><div class="k">Localidad</div><div class="v" id="d_loc">—</div></div>
    <div class="uh-kv"><div class="k">Calle</div><div class="v" id="d_calle">—</div></div>
    <div class="uh-kv"><div class="k">Tipo</div><div class="v" id="d_tipo">—</div></div>

    <div class="uh-kv"><div class="k">Precio</div><div class="v" id="d_precio">—</div></div>
    <div class="uh-kv"><div class="k">Alquiler</div><div class="v" id="d_alq">—</div></div>
    <div class="uh-kv"><div class="k">Bruta</div><div class="v" id="d_bruta">—</div></div>
    <div class="uh-kv"><div class="k">Neta</div><div class="v" id="d_neta">—</div></div>
    <div class="uh-kv"><div class="k">Flujo</div><div class="v" id="d_flujo">—</div></div>
    <div class="uh-kv"><div class="k">Precio máx.</div><div class="v" id="d_pmax">—</div></div>
    <div class="uh-kv"><div class="k">Inversión</div><div class="v" id="d_inv">—</div></div>
    <div class="uh-kv"><div class="k">URL</div><div class="v" id="d_url">—</div></div>

    <h3 style="margin:14px 0 8px">Asignar a prospects</h3>
    <div id="p_list" class="uh-list-pros">—</div>

    <div class="actions" style="display:flex;gap:8px;flex-wrap:wrap;margin-top:12px">
      <button class="btn primary" id="d_guardar">Guardar asignación</button>
      <button class="btn" id="d_pdf">PDF</button>
      <button class="btn" id="d_editar">Abrir en Evaluar</button>
    </div>
  </div>
</aside>

<div id="toasts" class="toast-wrap"></div>

<script>
(function(){
"use strict";

/* ===== Utils ===== */
var $ = function(x){return document.getElementById(x)};
var fmtE0 = new Intl.NumberFormat('es-ES',{style:'currency',currency:'EUR',maximumFractionDigits:0});
var fmtN0 = new Intl.NumberFormat('es-ES',{maximumFractionDigits:0});
var fmtN1 = new Intl.NumberFormat('es-ES',{maximumFractionDigits:1});
function e0(v){return fmtE0.format(Number(v||0))}
function pct(v){return fmtN1.format(Number(v||0))+' %'}
function parseNum(v){return Number(String(v==null?'':v).replace(/[^\d,.-]/g,'').replace(/\./g,'').replace(',', '.'))||0}
function esc(s){return (s==null?'':String(s)).replace(/[&<>"']/g,function(m){return ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])})}
function toast(msg,kind){
  var wrap=$('toasts'); if(!wrap) return;
  var el=document.createElement('div'); el.className='toast '+(kind||''); el.textContent=msg;
  wrap.appendChild(el); setTimeout(function(){el.style.opacity='0'},1600);
  setTimeout(function(){try{wrap.removeChild(el)}catch(e){}},2200);
}
function toPct(raw){ var v=Number(raw||0); if(v>0&&v<=1) v*=100; if(v>200) v/=10; return v; } // defensivo

/* ===== Store con migración ===== */
function readJSON(key){
  try{ return JSON.parse(localStorage.getItem(key)||'null') }catch(_){ return null }
}
function migrateEvals(){
  var pools = [];
  var keys = ['evals','evaluaciones','evaluaciones_list','buybox_evals'];
  keys.forEach(function(k){
    var v = readJSON(k);
    if(Array.isArray(v) && v.length) pools.push(v);
  });
  // último cartucho: buscar arrays “parecidos” en localStorage
  try{
    for(var i=0;i<localStorage.length;i++){
      var k = localStorage.key(i);
      if(!k) continue;
      var v = readJSON(k);
      if(Array.isArray(v) && v.length && typeof v[0]==='object' && ('precio' in v[0] || 'alq' in v[0])){
        pools.push(v);
      }
    }
  }catch(_){}
  // aplanar + deduplicar por id o ts
  var map = {};
  pools.forEach(function(arr){
    arr.forEach(function(e){
      var id = e.id || ('ev_'+(e.ts||Date.now()));
      if(!map[id]){ map[id]=Object.assign({id:id},e); }
    });
  });
  var out = Object.keys(map).map(function(k){return map[k]});
  if(out.length){
    try{ localStorage.setItem('evals', JSON.stringify(out)); }catch(_){}
  }
  return out;
}
var Store={
  get evals(){
    var v = readJSON('evals');
    if(Array.isArray(v) && v.length) return v;
    return migrateEvals();
  },
  set evals(val){ localStorage.setItem('evals', JSON.stringify(val)); },
  get pros(){ return readJSON('pros') || []; },
  set pros(v){ localStorage.setItem('pros', JSON.stringify(v)); }
};

/* ===== Estado ===== */
var data=[], view=[], sortKey='ts', sortAsc=true, openId=null;

/* ===== Carga + KPIs ===== */
function load(){
  var list = Store.evals || [];
  data = list.map(function(e){ return Object.assign({},e,{asig:(e.prospect_ids||[]).length})});
  var empty = !data.length;
  $('empty').style.display = empty?'block':'none';
  $('tbl').style.display   = empty?'none':'table';
  applyFilters(); kpis();
}
function kpis(){
  $('k_total').textContent = data.length;
  $('k_asig').textContent = data.reduce(function(a,b){return a+(b.asig||0)},0);
  $('k_bruta').textContent = pct(avg(data.map(function(x){return toPct(x.kpi_bruta)})));
  $('k_neta').textContent  = pct(avg(data.map(function(x){return toPct(x.kpi_neta)})));
}
function avg(arr){return arr.length? arr.reduce(function(a,b){return a+Number(b||0)},0)/arr.length : 0}

/* ===== Filtros/orden ===== */
function applyFilters(){
  var q=($('f_text').value||'').toLowerCase().trim();
  var t=$('f_tipo').value||'';
  var d=$('f_desde').value? new Date($('f_desde').value+'T00:00:00Z').getTime():0;
  var h=$('f_hasta').value? new Date($('f_hasta').value+'T23:59:59Z').getTime():Infinity;
  view=data.filter(function(e){
    var ts=new Date(e.ts|| (e.id&&e.id.slice?e.id.slice(3):Date.now())).getTime();
    var txt=((e.loc||'')+' '+(e.calle||'')).toLowerCase();
    return (!q || txt.indexOf(q)>-1) && (!t || e.tipo===t) && ts>=d && ts<=h;
  });
  sort(); render();
}
function sort(){
  view.sort(function(a,b){
    var va=get(a,sortKey), vb=get(b,sortKey);
    return (va<vb? -1: va>vb? 1: 0) * (sortAsc?1:-1);
  });
}
function get(o,k){
  if(k==='ts') return new Date(o.ts|| (o.id&&o.id.slice?o.id.slice(3):Date.now())).getTime();
  if(k==='asig') return (o.prospect_ids||[]).length;
  if(k==='kpi_bruta') return toPct(o.kpi_bruta);
  if(k==='kpi_neta') return toPct(o.kpi_neta);
  if(k==='kpi_flujo') return Number(parseNum(o.kpi_flujo));
  if(k==='pmax') return Number(o.pmax||0);
  if(k==='precio') return Number(o.precio||0);
  if(k==='alq') return Number(o.alq||0);
  if(k==='calle') return (o.calle||'').toLowerCase();
  return (o[k]||'').toString().toLowerCase();
}

/* ===== Render tabla ===== */
function render(){
  var tb=$('tbody'); tb.innerHTML='';
  view.forEach(function(e){
    var tr=document.createElement('tr'); tr.dataset.id=e.id;
    var f=new Date(e.ts|| (e.id&&e.id.slice?e.id.slice(3):Date.now())).toLocaleDateString('es-ES');
    tr.innerHTML=
      '<td>'+f+'</td>'+
      '<td>'+esc(e.loc||'')+'</td>'+
      '<td>'+esc(e.calle||'')+'</td>'+
      '<td><span class="pill">'+esc(e.tipo||'-')+'</span></td>'+
      '<td style="text-align:right">'+e0(e.precio)+'</td>'+
      '<td style="text-align:right">'+e0(e.alq)+'</td>'+
      '<td style="text-align:right">'+fmtN1.format(toPct(e.kpi_bruta))+' %</td>'+
      '<td style="text-align:right">'+fmtN1.format(toPct(e.kpi_neta))+' %</td>'+
      '<td style="text-align:right">'+e0(e.kpi_flujo)+'</td>'+
      '<td style="text-align:right">'+e0(e.pmax)+'</td>'+
      '<td style="text-align:center">'+(e.prospect_ids||[]).length+'</td>'+
      '<td><button class="btn sm" data-act="ver">Ver</button> '+
      '<button class="btn sm" data-act="del">Borrar</button></td>';
    tb.appendChild(tr);
  });
}

/* ===== Drawer detalle + asignación ===== */
function openDrawer(idEv){
  openId=idEv;
  var list=Store.evals||[];
  var e=list.find(function(x){return x.id===idEv}); if(!e) return;

  $('d_fecha').textContent=new Date(e.ts|| (e.id&&e.id.slice?e.id.slice(3):Date.now())).toLocaleString('es-ES');
  $('d_loc').textContent =e.loc||'—';
  $('d_calle').textContent=e.calle||'—';
  $('d_tipo').textContent =e.tipo||'—';
  $('d_precio').textContent=e0(e.precio);
  $('d_alq').textContent =e0(e.alq);
  $('d_bruta').textContent =fmtN1.format(toPct(e.kpi_bruta))+' %';
  $('d_neta').textContent =fmtN1.format(toPct(e.kpi_neta))+' %';
  $('d_flujo').textContent =e0(e.kpi_flujo);
  $('d_pmax').textContent =e0(e.pmax);
  $('d_inv').textContent =e0(e.inv_total);
  $('d_url').innerHTML = e.url ? '<a href="'+e.url+'" target="_blank" rel="noopener">Abrir</a>' : '—';

  var wrap=$('p_list'); wrap.innerHTML='';
  var pros=Store.pros||[]; var set=new Set(e.prospect_ids||[]);
  if(!pros.length){ wrap.textContent='No hay prospects guardados.'; }
  else{
    pros.forEach(function(p){
      var row=document.createElement('label');
      var cb=document.createElement('input'); cb.type='checkbox';
      cb.value=p.id||p.email||p.nombre; cb.checked=set.has(cb.value);
      var sp=document.createElement('span');
      sp.textContent=(p.nombre||'—')+' · '+(p.pref_tipo||'-')+' · '+(p.locs_text||'');
      row.appendChild(cb); row.appendChild(sp);
      wrap.appendChild(row);
    });
  }

  $('uhOverlay').classList.add('open');
  $('uhDrawer').classList.add('open');

  $('d_guardar').onclick = saveAssign;
  $('d_pdf').onclick = function(){ quickPDF(e.id) };
  $('d_editar').onclick = function(){ goEvaluar(e.id) };
}
function closeDrawer(){
  $('uhOverlay').classList.remove('open');
  $('uhDrawer').classList.remove('open');
  openId=null;
}
function saveAssign(){
  if(!openId) return;
  var list=Store.evals||[];
  var idx=list.findIndex(function(x){return x.id===openId}); if(idx<0) return;
  var choices=[].slice.call($('p_list').querySelectorAll('input[type=checkbox]'));
  list[idx].prospect_ids = choices.filter(function(c){return c.checked}).map(function(c){return c.value});
  Store.evals=list;
  toast('Asignación guardada','ok');
  closeDrawer(); load();
}

/* ===== Abrir en Evaluar ===== */
function goEvaluar(idEv){
  try{ localStorage.setItem('last_eval_id', idEv); }catch(_){}
  location.href = 'evaluar.html?id='+encodeURIComponent(idEv);
}

/* ===== PDF rápido (sin template strings) ===== */
function quickPDF(idEv){
  var e=(Store.evals||[]).find(function(x){return x.id===idEv}); if(!e){toast('No encontrado','bad');return;}
  var fecha=new Date(e.ts|| (e.id&&e.id.slice?e.id.slice(3):Date.now())).toLocaleString('es-ES');
  var lines=[];
  lines.push('<!DOCTYPE html><html><head><meta charset="utf-8"><title>Informe — '+esc(e.loc||'')+'</title>');
  lines.push('<style>body{font-family:Inter,Arial;color:#101828;margin:24px}h1{font-size:22px;margin:0 0 6px}h2{font-size:16px;margin:16px 0 8px}.grid{display:grid;grid-template-columns:1fr 1fr;gap:8px}.box{border:1px solid #e5e7eb;border-radius:10px;padding:10px}.lab{font-size:12px;color:#667085}.val{font-weight:800}.foot{margin-top:16px;font-size:12px;color:#667085;text-align:center}</style></head><body>');
  lines.push('<h1>Informe BuyBox — Unihouser</h1>');
  lines.push('<div class="lab">'+esc(fecha)+'</div>');
  lines.push('<h2>Resumen financiero</h2>');
  lines.push('<div class="grid">');
  lines.push('<div class="box"><div class="lab">Bruta</div><div class="val">'+fmtN1.format(toPct(e.kpi_bruta))+' %</div></div>');
  lines.push('<div class="box"><div class="lab">Neta</div><div class="val">'+fmtN1.format(toPct(e.kpi_neta))+' %</div></div>');
  lines.push('<div class="box"><div class="lab">Flujo anual</div><div class="val">'+fmtE0.format(Number(parseNum(e.kpi_flujo)))+'</div></div>');
  lines.push('<div class="box"><div class="lab">P. máx compra</div><div class="val">'+fmtE0.format(e.pmax||0)+'</div></div>');
  lines.push('</div>');
  lines.push('<h2>Datos del inmueble</h2>');
  lines.push('<div class="grid">');
  lines.push('<div class="box"><div class="lab">Localidad</div><div class="val">'+esc(e.loc||'-')+'</div></div>');
  lines.push('<div class="box"><div class="lab">Calle</div><div class="val">'+esc(e.calle||'-')+'</div></div>');
  lines.push('<div class="box"><div class="lab">Tipo</div><div class="val">'+esc(e.tipo||'-')+'</div></div>');
  lines.push('<div class="box"><div class="lab">Alquiler</div><div class="val">'+fmtE0.format(e.alq||0)+'</div></div>');
  lines.push('<div class="box"><div class="lab">Precio</div><div class="val">'+fmtE0.format(e.precio||0)+'</div></div>');
  lines.push('<div class="box"><div class="lab">Inversión total</div><div class="val">'+fmtE0.format(e.inv_total||0)+'</div></div>');
  lines.push('</div>');
  lines.push('<div class="foot">© 2025 Unihouser · unihouser.es · info@unihouser.es · 644 300 200</div>');
  lines.push('</body></html>');
  var w=window.open('about:blank','_blank'); w.document.open(); w.document.write(lines.join('')); w.document.close();
  var tryPrint=function(){ try{ w.focus(); w.print(); }catch(_){ } };
  w.onload = tryPrint; setTimeout(tryPrint, 600);
}

/* ===== CSV extendido ===== */
function toCSV(rows){
  var headers=["Fecha","Localidad","Calle","Tipo","Precio","Alquiler","Bruta%","Neta%","Flujo","Pmax","Inversion","ITP","Notaria","Reforma","Comunidad","IBI","Hogar","Impago","Gestion","m2","Anio","Ascensor","Bajo","Altura","Habs","Banos","URL","Asignados"];
  var out=[headers.join(';')];
  rows.forEach(function(e){
    var f=new Date(e.ts|| (e.id&&e.id.slice?e.id.slice(3):Date.now())).toLocaleDateString('es-ES');
    var row=[
      f, safe(e.loc), safe(e.calle), safe(e.tipo),
      numfmt(e.precio), numfmt(e.alq),
      pctfmt(toPct(e.kpi_bruta)), pctfmt(toPct(e.kpi_neta)),
      numfmt(e.kpi_flujo), numfmt(e.pmax), numfmt(e.inv_total),
      numfmt(e.itp_eur), numfmt(e.notaria), numfmt(e.reforma), numfmt(e.comunidad),
      numfmt(e.ibi), numfmt(e.hogar), numfmt(e.impago), numfmt(e.gestion),
      safe(e.m2), safe(e.anio), safe(e.asc?'Sí':'No'), safe(e.bajo?'Sí':'No'),
      safe(e.alt), safe(e.habs), safe(e.banos), safe(e.url),
      (e.prospect_ids||[]).length
    ];
    out.push(row.join(';'));
  });
  return out.join('\n');
}
function numfmt(v){return fmtN0.format(Number(parseNum(v)||v||0))}
function pctfmt(v){return fmtN1.format(Number(v||0))}
function safe(s){return (s==null?'':String(s)).replace(/;/g,',')}
function download(name,content){
  var blob=new Blob([content],{type:'text/csv;charset=utf-8;'});
  var a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download=name;
  document.body.appendChild(a); a.click();
  setTimeout(function(){URL.revokeObjectURL(a.href); a.remove();},0);
}

/* ===== Eventos ===== */
function onTableClick(ev){
  var btn=ev.target.closest('button[data-act]'); var tr=ev.target.closest('tr');
  if(!tr) return; var idEv=tr.dataset.id;
  if(btn){
    var act=btn.dataset.act;
    if(act==='ver') openDrawer(idEv);
    if(act==='del'){ if(confirm('¿Borrar esta evaluación?')){ Store.evals=(Store.evals||[]).filter(function(x){return x.id!==idEv}); load(); } }
  }else{
    openDrawer(idEv);
  }
}
function bindSort(){
  [].slice.call(document.querySelectorAll('#tbl th[data-k]')).forEach(function(th){
    th.addEventListener('click',function(){
      var k=th.dataset.k;
      if(sortKey===k) sortAsc=!sortAsc; else{sortKey=k; sortAsc=true;}
      sort(); render();
    });
  });
}
function attach(){
  $('b_filtrar').addEventListener('click',applyFilters);
  $('b_limpiar').addEventListener('click',function(){ $('f_text').value=''; $('f_tipo').value=''; $('f_desde').value=''; $('f_hasta').value=''; applyFilters();});
  $('b_export').addEventListener('click',function(){ if(!view.length){toast('Nada que exportar','warn');return;} download('evaluaciones.csv',toCSV(view)); });
  $('tbody').addEventListener('click',onTableClick);
  $('d_cerrar').addEventListener('click',closeDrawer);
  $('uhOverlay').addEventListener('click',closeDrawer);
  bindSort(); load();
}
document.addEventListener('DOMContentLoaded',attach);
})();
</script>
</body>
</html>
